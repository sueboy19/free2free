# 資訊安全設計

## 主要安全風險與防護措施

### 1. OAuth 認證安全
**風險**: 
- OAuth token 被截取
- CSRF 攻擊
- 使用者身份偽造

**防護措施**:
- 使用 Facebook/Instagram 官方 Go SDK 進行認證
- 實作 OAuth state parameter 防止 CSRF
- 驗證 token 有效性與使用者資訊
- 使用 HTTPS 加密傳輸

### 2. 輸入驗證與清理
**風險**:
- SQL Injection
- XSS (跨站腳本攻擊)
- 不合法資料輸入

**防護措施**:
- 所有使用者輸入都需伺服器端驗證
- 使用參數化查詢防止 SQL injection
- 對輸出到前端的資料進行 HTML 转义防止 XSS
- 使用正規表示式驗證輸入格式 (如時間、數字)
- 限制輸入長度

### 3. 權限控制
**風險**:
- 未經授權存取管理功能
- 使用者操作超出權限範圍的資源
- 資料越權存取

**防護措施**:
- 實作 RBAC (Role-Based Access Control)
- 每個 API endpoint 都需驗證使用者身份與權限
- 開局者只能審核自己建立的配對局
- 使用者只能評分自己參與的配對
- 管理後台需獨立的管理員認證

### 4. API 安全
**風險**:
- API 濫用 (過度請求)
- 敏感資訊洩漏
- 未經授權的 API 存取

**防護措施**:
- 實作 API rate limiting (使用 redis 記錄請求次數)
- 敏感操作需二次確認 (如刪除)
- 使用 JWT token 進行 API 認證
- API response 不包含敏感資訊 (如密碼、內部 ID)
- 使用 HTTPS 加密所有 API 通訊

### 5. 資料保護
**風險**:
- 資料庫洩漏
- 敏感資料明文儲存
- 備份資料安全

**防護措施**:
- 密碼使用 bcrypt 加密儲存
- 敏感資料 (如管理員密碼) 使用 AES 加密
- 資料庫定期備份並加密儲存
- 限制資料庫存取權限
- 使用環境變數管理密鑰

### 6. 會話管理
**風險**:
- Session fixation
- Session hijacking
- 會話超時

**防護措施**:
- 使用安全的 session 管理機制 (如 gorilla/sessions)
- 設定適當的 session 超時時間
- 登入後重新產生 session ID
- HTTPS-only cookies
- SameSite cookies 防止 CSRF

### 7. 錯誤處理
**風險**:
- 錯誤訊息洩漏系統資訊
- 未處理的例外狀況

**防護措施**:
- 自訂錯誤頁面，不顯示詳細系統錯誤
- 記錄錯誤日誌但不傳給前端
- 實作全域錯誤處理機制
- 對外部 API 錯誤進行適當處理

### 8. 部署安全
**風險**:
- 伺服器配置不當
- 未及時更新安全補丁
- 檔案上傳漏洞

**防護措施**:
- 使用反向代理 (如 Nginx) 並設定安全標頭
- 定期更新 Go 版本與相依套件
- 限制檔案上傳類型與大小 (本系統不涉及檔案上傳)
- 使用容器化部署 (Docker) 進行隔離

## 安全檢查清單
- [ ] 所有 API endpoint 都有身份驗證
- [ ] 敏感操作有權限檢查
- [ ] 輸入資料有伺服器端驗證
- [ ] 使用參數化查詢
- [ ] 對輸出資料進行 HTML 转义
- [ ] 實作 API rate limiting
- [ ] 使用 HTTPS
- [ ] Session 安全配置
- [ ] 錯誤訊息不洩漏敏感資訊
- [ ] 密碼使用 bcrypt 加密
- [ ] 定期安全審查與滲透測試